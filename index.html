<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Motorola Fix Beeper - Retro Edition</title>
    <style>
        :root {
            --bg: #d8d8c0;
            --main: #1a1a1a;
            --accent: #0055ff;
        }

        * { box-sizing: border-box; }

        body {
            background-color: var(--bg);
            background-image: radial-gradient(var(--main) 0.5px, transparent 0.5px);
            background-size: 30px 30px;
            margin: 0;
            padding: 0;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
            height: 100vh;
        }

        /* 绘图画布 */
        #canvas {
            position: absolute;
            inset: 0;
            z-index: 1;
        }

        /* 像素便签卡片 */
        .card {
            position: absolute;
            background: #fff;
            border: 2px solid var(--main);
            padding: 15px;
            width: 220px;
            box-shadow: 5px 5px 0px rgba(0,0,0,0.1);
            cursor: move;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.4;
            font-weight: bold;
            z-index: 10;
        }

        /* 底部控制栏 */
        .dock {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 100;
        }

        .pixel-btn {
            background: var(--main);
            color: white;
            border: none;
            padding: 12px 24px;
            cursor: pointer;
            font-family: inherit;
            box-shadow: 4px 4px 0px #888;
        }

        .pixel-btn:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px #888;
        }

        /* 复古弹窗 */
        #modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-box {
            background: var(--bg);
            border: 3px solid var(--main);
            padding: 25px;
            width: 320px;
            position: relative;
        }

        textarea {
            width: 100%;
            height: 100px;
            margin: 10px 0;
            border: 2px solid var(--main);
            padding: 10px;
            font-family: inherit;
            background: #fdfdfd;
            resize: none;
        }

        /* 磁带动画 */
        .tape-player {
            background: #333;
            height: 80px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 15px 0;
        }

        .reel {
            width: 40px;
            height: 40px;
            border: 3px dashed #666;
            border-radius: 50%;
        }

        .spinning { animation: spin 2s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .status-text { font-size: 10px; text-align: center; color: var(--main); }
    </style>
</head>
<body>

    <div id="canvas"></div>

    <div class="dock">
        <button class="pixel-btn" onclick="openModal('text')">新建便签</button>
        <button class="pixel-btn" style="background: var(--accent);" onclick="openModal('audio')">磁带模式</button>
    </div>

    <div id="modal" onclick="if(event.target==this) closeModal()">
        <div class="modal-box">
            <div id="text-ui">
                <div style="font-size: 12px;">INPUT MESSAGE (ENTER TO WRAP):</div>
                <textarea id="msg-input" placeholder="输入你想说的话..."></textarea>
                <button class="pixel-btn" style="width:100%" onclick="startPrint()">确认打印</button>
            </div>

            <div id="audio-ui" style="display:none">
                <div style="font-size: 12px;">LOAD EXTERNAL TAPE (.MP3):</div>
                <input type="file" id="file-input" accept="audio/*" style="width:100%; margin: 10px 0;">
                <div class="tape-player">
                    <div class="reel" id="reel-1"></div>
                    <div class="reel" id="reel-2"></div>
                </div>
                <div class="status-text" id="audio-status">IDLE</div>
                <button class="pixel-btn" style="width:100%; margin-top:10px;" onclick="toggleAudio()">播放 / 暂停</button>
            </div>
            
            <p onclick="closeModal()" style="text-align:center; font-size:12px; cursor:pointer; text-decoration:underline; margin-top:15px;">[ 返回 ]</p>
        </div>
    </div>

    <audio id="main-player"></audio>

    <script>
        const modal = document.getElementById('modal');
        const player = document.getElementById('main-player');
        const reels = document.querySelectorAll('.reel');
        let isPrinting = false;

        function openModal(mode) {
            modal.style.display = 'flex';
            document.getElementById('text-ui').style.display = mode === 'text' ? 'block' : 'none';
            document.getElementById('audio-ui').style.display = mode === 'audio' ? 'block' : 'none';
        }

        function closeModal() { modal.style.display = 'none'; }

        // 打字机逻辑
        async function startPrint() {
            const text = document.getElementById('msg-input').value || "EMPTY\nMESSAGE";
            if(isPrinting) return;
            isPrinting = true;
            closeModal();

            const card = document.createElement('div');
            card.className = 'card';
            card.style.left = (Math.random() * 50 + 10) + '%';
            card.style.top = (Math.random() * 50 + 10) + '%';
            document.getElementById('canvas').appendChild(card);
            
            enableDrag(card);

            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

            for (let i = 0; i <= text.length; i++) {
                card.textContent = text.substring(0, i) + (i < text.length ? '█' : '');
                playClick(audioCtx);
                // 遇到换行停顿久一点
                const delay = text[i-1] === '\n' ? 300 : 70 + Math.random() * 50;
                await new Promise(r => setTimeout(r, delay));
            }
            isPrinting = false;
        }

        function playClick(ctx) {
            if(ctx.state === 'suspended') ctx.resume();
            const osc = ctx.createOscillator();
            const g = ctx.createGain();
            osc.type = 'square';
            osc.frequency.value = 600;
            g.gain.setValueAtTime(0.05, ctx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.05);
            osc.connect(g);
            g.connect(ctx.destination);
            osc.start();
            osc.stop(ctx.currentTime + 0.05);
        }

        // 音频逻辑
        document.getElementById('file-input').onchange = (e) => {
            const file = e.target.files[0];
            if(file) {
                player.src = URL.createObjectURL(file);
                document.getElementById('audio-status').innerText = "READY: " + file.name.substring(0,15) + "...";
            }
        };

        function toggleAudio() {
            if(player.paused) {
                player.play();
                reels.forEach(r => r.classList.add('spinning'));
                document.getElementById('audio-status').innerText = "STATUS: PLAYING";
            } else {
                player.pause();
                reels.forEach(r => r.classList.remove('spinning'));
                document.getElementById('audio-status').innerText = "STATUS: PAUSED";
            }
        }

        // 基础拖拽
        function enableDrag(el) {
            let x = 0, y = 0;
            el.onmousedown = (e) => {
                x = e.clientX; y = e.clientY;
                document.onmousemove = (ev) => {
                    el.style.left = (el.offsetLeft + ev.clientX - x) + "px";
                    el.style.top = (el.offsetTop + ev.clientY - y) + "px";
                    x = ev.clientX; y = ev.clientY;
                };
                document.onmouseup = () => { document.onmousemove = null; };
            };
        }
    </script>
</body>
</html>
